<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 3 章 Stata 基础操作 | Stata for Data Science</title>
  <meta name="description" content="Stata 数据科学" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="第 3 章 Stata 基础操作 | Stata for Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Stata 数据科学" />
  <meta name="github-repo" content="czxa/stata4ds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 3 章 Stata 基础操作 | Stata for Data Science" />
  
  <meta name="twitter:description" content="Stata 数据科学" />
  

<meta name="author" content="程振兴" />


<meta name="date" content="2019-08-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-8.html">
<link rel="next" href="section-23.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stata for Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 前言</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#r--stata"><i class="fa fa-check"></i><b>1.1</b> 从 R 到 Stata</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#stata--r"><i class="fa fa-check"></i><b>1.2</b> 从 Stata 到 R</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#section-1"><i class="fa fa-check"></i><b>1.3</b> 本书内容</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#section-2"><i class="fa fa-check"></i><b>1.4</b> 阅读本书之前的准备工作</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#section-3"><i class="fa fa-check"></i><b>1.5</b> 目标读者</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#section-4"><i class="fa fa-check"></i><b>1.6</b> 排版约定</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#section-5"><i class="fa fa-check"></i><b>1.7</b> 下载示例代码</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#section-6"><i class="fa fa-check"></i><b>1.8</b> 许可证</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#section-7"><i class="fa fa-check"></i><b>1.9</b> 读者反馈</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>2</b> 导论</a><ul>
<li class="chapter" data-level="2.1" data-path="section-8.html"><a href="section-8.html#section-9"><i class="fa fa-check"></i><b>2.1</b> 准备工作</a></li>
<li class="chapter" data-level="2.2" data-path="section-8.html"><a href="section-8.html#stata4ds-"><i class="fa fa-check"></i><b>2.2</b> stata4ds 命令包</a></li>
<li class="chapter" data-level="2.3" data-path="section-8.html"><a href="section-8.html#stata-"><i class="fa fa-check"></i><b>2.3</b> 运行 Stata 代码</a></li>
<li class="chapter" data-level="2.4" data-path="section-8.html"><a href="section-8.html#section-10"><i class="fa fa-check"></i><b>2.4</b> 获取帮助</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="stata-1.html"><a href="stata-1.html"><i class="fa fa-check"></i><b>3</b> Stata 基础操作</a><ul>
<li class="chapter" data-level="3.1" data-path="stata-1.html"><a href="stata-1.html#stata--2"><i class="fa fa-check"></i><b>3.1</b> Stata 是什么？</a></li>
<li class="chapter" data-level="3.2" data-path="stata-1.html"><a href="stata-1.html#stata--3"><i class="fa fa-check"></i><b>3.2</b> Stata 能做什么？</a></li>
<li class="chapter" data-level="3.3" data-path="stata-1.html"><a href="stata-1.html#stata--4"><i class="fa fa-check"></i><b>3.3</b> Stata 基本操作</a></li>
<li class="chapter" data-level="3.4" data-path="stata-1.html"><a href="stata-1.html#section-15"><i class="fa fa-check"></i><b>3.4</b> 数据处理</a></li>
<li class="chapter" data-level="3.5" data-path="stata-1.html"><a href="stata-1.html#section-16"><i class="fa fa-check"></i><b>3.5</b> 数据导出</a></li>
<li class="chapter" data-level="3.6" data-path="stata-1.html"><a href="stata-1.html#section-17"><i class="fa fa-check"></i><b>3.6</b> 绘图</a></li>
<li class="chapter" data-level="3.7" data-path="stata-1.html"><a href="stata-1.html#section-18"><i class="fa fa-check"></i><b>3.7</b> 统计相关</a></li>
<li class="chapter" data-level="3.8" data-path="stata-1.html"><a href="stata-1.html#t"><i class="fa fa-check"></i><b>3.8</b> t检验、方差分析和因子分析</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-23.html"><a href="section-23.html"><i class="fa fa-check"></i><b>4</b> 探索性分析</a><ul>
<li class="chapter" data-level="4.1" data-path="section-23.html"><a href="section-23.html#section-24"><i class="fa fa-check"></i><b>4.1</b> 导论</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-25.html"><a href="section-25.html"><i class="fa fa-check"></i><b>5</b> 数据可视化</a><ul>
<li class="chapter" data-level="5.1" data-path="section-25.html"><a href="section-25.html#section-26"><i class="fa fa-check"></i><b>5.1</b> 导论</a></li>
<li class="chapter" data-level="5.2" data-path="section-25.html"><a href="section-25.html#section-27"><i class="fa fa-check"></i><b>5.2</b> 准备工作</a></li>
<li class="chapter" data-level="5.3" data-path="section-25.html"><a href="section-25.html#section-28"><i class="fa fa-check"></i><b>5.3</b> 第一步</a></li>
<li class="chapter" data-level="5.4" data-path="section-25.html"><a href="section-25.html#section-31"><i class="fa fa-check"></i><b>5.4</b> 散点图进阶</a></li>
<li class="chapter" data-level="5.5" data-path="section-25.html"><a href="section-25.html#section-32"><i class="fa fa-check"></i><b>5.5</b> 分面</a></li>
<li class="chapter" data-level="5.6" data-path="section-25.html"><a href="section-25.html#section-33"><i class="fa fa-check"></i><b>5.6</b> 几何对象</a></li>
<li class="chapter" data-level="5.7" data-path="section-25.html"><a href="section-25.html#section-34"><i class="fa fa-check"></i><b>5.7</b> 统计变换</a></li>
<li class="chapter" data-level="5.8" data-path="section-25.html"><a href="section-25.html#section-35"><i class="fa fa-check"></i><b>5.8</b> 位置调整</a></li>
<li class="chapter" data-level="5.9" data-path="section-25.html"><a href="section-25.html#section-36"><i class="fa fa-check"></i><b>5.9</b> 坐标系统</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-37.html"><a href="section-37.html"><i class="fa fa-check"></i><b>6</b> 工作流程：基础</a><ul>
<li class="chapter" data-level="6.1" data-path="section-37.html"><a href="section-37.html#section-38"><i class="fa fa-check"></i><b>6.1</b> 编程的基础知识</a></li>
<li class="chapter" data-level="6.2" data-path="section-37.html"><a href="section-37.html#stata--6"><i class="fa fa-check"></i><b>6.2</b> Stata 的变量名</a></li>
<li class="chapter" data-level="6.3" data-path="section-37.html"><a href="section-37.html#section-39"><i class="fa fa-check"></i><b>6.3</b> 调用函数</a></li>
<li class="chapter" data-level="6.4" data-path="section-37.html"><a href="section-37.html#section-40"><i class="fa fa-check"></i><b>6.4</b> 实践</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-41.html"><a href="section-41.html"><i class="fa fa-check"></i><b>7</b> 数据变形</a><ul>
<li class="chapter" data-level="7.1" data-path="section-41.html"><a href="section-41.html#nycflights13-"><i class="fa fa-check"></i><b>7.1</b> nycflights13 数据集</a></li>
<li class="chapter" data-level="7.2" data-path="section-41.html"><a href="section-41.html#section-42"><i class="fa fa-check"></i><b>7.2</b> 筛选</a></li>
<li class="chapter" data-level="7.3" data-path="section-41.html"><a href="section-41.html#section-43"><i class="fa fa-check"></i><b>7.3</b> 缺失值</a></li>
<li class="chapter" data-level="7.4" data-path="section-41.html"><a href="section-41.html#section-44"><i class="fa fa-check"></i><b>7.4</b> 排列</a></li>
<li class="chapter" data-level="7.5" data-path="section-41.html"><a href="section-41.html#section-47"><i class="fa fa-check"></i><b>7.5</b> 选择</a></li>
<li class="chapter" data-level="7.6" data-path="section-41.html"><a href="section-41.html#section-48"><i class="fa fa-check"></i><b>7.6</b> 变量重命名</a></li>
<li class="chapter" data-level="7.7" data-path="section-41.html"><a href="section-41.html#section-49"><i class="fa fa-check"></i><b>7.7</b> 生成新的变量</a></li>
<li class="chapter" data-level="7.8" data-path="section-41.html"><a href="section-41.html#section-50"><i class="fa fa-check"></i><b>7.8</b> 分组汇总</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-56.html"><a href="section-56.html"><i class="fa fa-check"></i><b>8</b> 探索性数据分析</a><ul>
<li class="chapter" data-level="8.1" data-path="section-56.html"><a href="section-56.html#section-57"><i class="fa fa-check"></i><b>8.1</b> 问题</a></li>
<li class="chapter" data-level="8.2" data-path="section-56.html"><a href="section-56.html#section-58"><i class="fa fa-check"></i><b>8.2</b> 变化</a></li>
<li class="chapter" data-level="8.3" data-path="section-56.html"><a href="section-56.html#section-60"><i class="fa fa-check"></i><b>8.3</b> 典型值</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">使用 bookdown 编排</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stata for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stata--1" class="section level1">
<h1><span class="header-section-number">第 3 章</span> Stata 基础操作</h1>
<div id="stata--2" class="section level2">
<h2><span class="header-section-number">3.1</span> Stata 是什么？</h2>
<p>根据 Stata 对自己的介绍：</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Stata is a statistical package for managing, analyzing, and graphing data.</li>
<li>Stata is available for a variety of platforms. Stata may be used either as a point-and-click application or as a command-driven package.</li>
<li>Stata’s GUI provides an easy interface for those new to Stata and for experienced Stata users who
wish to execute a command that they seldom use.</li>
<li>The command language provides a fast way to communicate with Stata and to communicate more complex ideas.</li>
</ol>
</blockquote>
<p>也就是说， Stata 是一个集数据管理、分析和可视化的工具。可以在各种操作系统中使用，可以通过鼠标点击操作也能通过命令行驱动。</p>
<p>Stata 的图形用户界面让新手们很方便入门，Stata 的命令语言使得很多复杂的想法变得容易实现。</p>
<p>我经常看到很多 R、Python、Matlab 用户对 Stata 非常不屑一顾。每每提及 Stata 总是要加一句：</p>
<blockquote>
<p>“如果Stata也算编程语言的话······”</p>
</blockquote>
<p>我也常听一些没有接触过编程的朋友对Stata望而却步，他们常说：</p>
<blockquote>
<p>“虽然看不懂，但是觉得很厉害的样子。”</p>
</blockquote>
<p>所以Stata是什么？在 Stata 中运行 <code>help class</code> 命令你就可以看到下面的一段介绍：</p>
<blockquote>
<p>Stata’s two programming languages, ado and Mata, each support object-oriented programming. [P] class explains object-oriented programming in ado. Most users interested in object-oriented programming will wish to do the programming in Mata. See [M-2] class to learn about object-oriented programming in Mata.</p>
</blockquote>
<p>Stata 是套体系完整的面向对象的编程语言。两种编程语言，<strong>ado</strong> 和 <strong>Mata</strong> ，第一种较为常用，第二种更为强大。</p>
</div>
<div id="stata--3" class="section level2">
<h2><span class="header-section-number">3.2</span> Stata 能做什么？</h2>
<ol style="list-style-type: decimal">
<li>数据获取与处理；
使用Stata可以比较快速的获取多种数据并迅速整理成研究者所需要的数据。</li>
<li>精美统计图形绘制与导出。
Stata的绘图系统是相当完整的。通过绘图主题的选择，Stata作图也可以非常的精美。</li>
<li>严谨可重复的实证研究。</li>
</ol>
<p>在熟练使用 Stata 之前，你的论文原材料可能是这样的（图 <a href="stata-1.html#fig:dirtydir">3.1</a> 并不是论文的原材料，是我随便截的，只是想表达乱）：</p>
<div class="figure" style="text-align: center"><span id="fig:dirtydir"></span>
<img src="assets/dirtydir.png" alt="一个乱七八糟的文件夹" width="90%" />
<p class="caption">
图 3.1: 一个乱七八糟的文件夹
</p>
</div>
<p>在此之前可能你的主要数据处理工具是 Excel ，并且还不会 Excel VBA ，所以经常会整夜整夜的复制粘贴。而这些工作实际上用几行 Stata 语句就能完成。</p>
<p>那你用熟练了 Stata 之后你的论文数据是什么样的呢？（假如你是一个像我一样的强迫症患者）</p>
<div class="figure" style="text-align: center"><span id="fig:cleandir"></span>
<img src="assets/cleandir.png" alt="一个整洁的项目文件夹" width="90%" />
<p class="caption">
图 3.2: 一个整洁的项目文件夹
</p>
</div>
<p>这个文件夹的目录结构是：</p>
<pre class="shell"><code>.
├── ADO
│   ├── carryforward.ado
│   ├── carryforward.hlp
│   ├── estadd.ado
│   ├── estadd.hlp
│   ├── esttab.ado
│   └── esttab.hlp
├── DATA
│   ├── beta.csv
│   └── mydata.dta
├── DO
│   ├── 表2-1-描述性统计表.do
│   ├── 表3-1-模型估计结果.do
│   ├── 图3-1-每个月份的风险暴露变化对股票流动性影响的差异.do
│   ├── 表3-2-模型估计结果.do
│   ├── 图3-2-每个年份风险暴露变化对股票流动性影响的差异.do
│   ├── 表4-1-稳健性检验结果.do
│   └── 设定绘图主题.do
├── DOCS
│   └──  风险暴露的变化对股票流动性的影响.pdf
├── IMAGE
│   ├── 年份效应.png
│   └── 月份效应.png
├── 主程序.do
└── 参考文献
    └── 110228635.pdf</code></pre>
<p>在用Stata之前，每次画图你可能都要在 Excel 上面点击无数次。而用 Stata 之后，即使是下面这样复杂的图，你只需要一行命令就能绘制出来：</p>
<div class="figure" style="text-align: center"><span id="fig:sci"></span>
<img src="assets/stkpv4.png" alt="上证指数蜡烛图" width="90%" />
<p class="caption">
图 3.3: 上证指数蜡烛图
</p>
</div>
<p>此外，如果你还会一些数据库或其它编程软件，Stata能够很好的和它们交互使用。</p>
<p>如果说 Stata 不是最好的，我觉得 Stata 是做实证研究的最好工具。</p>
<ol style="list-style-type: decimal">
<li>Stata 作为商业软件，有着专业且负责的团队维护。所以 Stata 的帮助文档是最让人喜爱的，这些也是很多开源软件无法比拟的。</li>
<li>Stata 的速度相对较快，Stata的启动速度远快于 Matlab、SAS 这些软件，且对电脑硬件要求较低，这是非常重要的，如果你想用一个软件，然后打开它就要等待几分钟。那我想你可能很快就烦了。另外 Stata 运行的速度也足够快。可以满足大多数用户的需要。</li>
<li>Stata 提供了很多可以把统计表格导出到 Word、PDF 和 Tex 文档的命令。实际上 Stata15 的 putdocx 命令搭配其它的一些命令可以直接实现论文的编排。</li>
</ol>
<p>我想以上的每一条都足以成为大家认真学习 Stata 的理由。</p>
<p>下面就让我们进入Stata的世界吧！</p>
</div>
<div id="stata--4" class="section level2">
<h2><span class="header-section-number">3.3</span> Stata 基本操作</h2>
<div id="stata--5" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Stata 系统文件夹</h3>
<p>运行 <code>sysdir</code> 命令即可得到 Stata 的系统文件夹列表：</p>
<pre class="stata"><code>sysdir
*&gt;    STATA:  /Applications/Stata15/
*&gt;     BASE:  /Applications/Stata15/ado/base/
*&gt;     SITE:  /Applications/Stata15/ado/site/
*&gt;     PLUS:  /Users/czx/Library/Application Support/Stata/ado/plus/
*&gt; PERSONAL:  /Users/czx/Library/Application Support/Stata/ado/personal/
*&gt; OLDPLACE:  ~/ado/</code></pre>
<ul>
<li><code>BASE</code> 文件夹包含了Stata官方的 ado 文件；</li>
<li><code>PERSONAL</code> 文件夹可以放置你自己的 ado-files；</li>
<li><code>PLUS</code> 文件夹在你下载外部命令时会被自动创建。</li>
</ul>
<p>另外运行 <code>adopath</code> 也可以得到：</p>
<pre class="stata"><code>adopath
*&gt;  [1]  (BASE)      &quot;/Applications/Stata15/ado/base/&quot;
*&gt;  [2]  (SITE)      &quot;/Applications/Stata15/ado/site/&quot;
*&gt;  [3]              &quot;.&quot;
*&gt;  [4]  (PERSONAL)  &quot;/Users/czx/Library/Application Support/Stata/ado/personal/&quot;
*&gt;  [5]  (PLUS)      &quot;/Users/czx/Library/Application Support/Stata/ado/plus/&quot;
*&gt;  [6]  (OLDPLACE)  &quot;~/ado/&quot;</code></pre>
<p><code>adopath</code> 命令的运行结果和 <code>sysdir</code> 基本相同，这里的排序也是 <code>Stata</code> 寻找 <code>ado</code> 文件的顺序。</p>
</div>
<div id="section-11" class="section level3">
<h3><span class="header-section-number">3.3.2</span> 数据导入</h3>
<div id="section-12" class="section level4">
<h4><span class="header-section-number">3.3.2.1</span> 导入系统数据集</h4>
<p>系统数据集就是位于系统文件夹的数据集，这些数据集一般是一些示例数据集。导入系统数据集是使用sysuse命令，最有名的系统数据集要数auto数据集了：</p>
<pre class="stata"><code>sysuse auto, clear</code></pre>
<p>这是个1978年的汽车数据集。这个数据集是这样的：</p>
<div class="figure" style="text-align: center"><span id="fig:auto"></span>
<img src="assets/auto.png" alt="1978年汽车数据集" width="90%" />
<p class="caption">
图 3.4: 1978年汽车数据集
</p>
</div>
<p>此外sysuse还可以用来查看所有的系统数据集：</p>
<pre class="stata"><code>sysuse dir
*&gt;  .dta               cjd1617.dta        lifeexp.dta        reshape1.dta
*&gt;  air2.dta           colorschemes.dta   lutkepohl2.dta     sandstone.dta
*&gt;  airq.dta           countycode.dta     moneysupply.dta    sexratio.dta
*&gt;  auto.dta           educ99gdp.dta      network1.dta       smoking.dta
*&gt;  auto2.dta          fullauto.dta       network1a.dta      sp500.dta
*&gt;  autornd.dta        ghanaage.dta       nhanes2f.dta       splotxmpl.dta
*&gt;  bplong.dta         gnp96.dta          nlsw88.dta         stackxmpl.dta
*&gt;  bpwide.dta         grunfeld.dta       nlswide1.dta       surface.dta
*&gt;  brewmeta.dta       houseprice.dta     nlswork.dta        tsline1.dta
*&gt;  cancer.dta         jd14151617xxb.dta  nlswork2.dta       tsline2.dta
*&gt;  census.dta         jd141516cjd.dta    parent.dta         uslifeexp.dta
*&gt;  child.dta          jd2017zsjh.dta     pop2000.dta        uslifeexp2.dta
*&gt;  citytemp.dta       jdcourse2018a.dta  population.dta     voter.dta
*&gt;  citytemp4.dta      lbw.dta            rate2.dta          xtline1.dta</code></pre>
<p>使用all选项可以查看所有的：</p>
<pre class="stata"><code>sysuse dir, all
*&gt;  .dta                  child.dta             network1a.dta
*&gt;  __i10v2003.dta        china_map.dta         nhanes2f.dta
*&gt;  __i10v2004.dta        citytemp.dta          nlsw88.dta
*&gt;  __i10v2006.dta        citytemp4.dta         nlswide1.dta
*&gt;  __i10v2007.dta        cjd1617.dta           nlswork.dta
*&gt;  __i10v2008.dta        colorschemes.dta      nlswork2.dta
*&gt;  __i10v2009.dta        countycode.dta        parent.dta
*&gt;  __i10v2010.dta        echarts_worldmap.dta  pop2000.dta
*&gt;  __i10v2011.dta        educ99gdp.dta         population.dta
*&gt;  __i10v2012.dta        fullauto.dta          rate2.dta
*&gt;  __i10v2013.dta        ghanaage.dta          reshape1.dta
*&gt;  __i10v2014.dta        gini_prov.dta         sandstone.dta
*&gt;  __i10v2016.dta        gnp96.dta             sexratio.dta
*&gt;  __icd10.dta           grunfeld.dta          smoking.dta
*&gt;  __icd10cm.dta         houseprice.dta        sp500.dta
*&gt;  __icd10pcs.dta        icd9_cod.dta          splotxmpl.dta
*&gt;  air2.dta              icd9_cop.dta          stackxmpl.dta
*&gt;  airq.dta              jd14151617xxb.dta     surface.dta
*&gt;  auto.dta              jd141516cjd.dta       tsline1.dta
*&gt;  auto2.dta             jd2017zsjh.dta        tsline2.dta
*&gt;  autornd.dta           jdcourse2018a.dta     uslifeexp.dta
*&gt;  bplong.dta            lbw.dta               uslifeexp2.dta
*&gt;  bpwide.dta            lifeexp.dta           voter.dta
*&gt;  brewmeta.dta          lutkepohl2.dta        xtline1.dta
*&gt;  cancer.dta            moneysupply.dta
*&gt;  census.dta            network1.dta</code></pre>
</div>
<div id="section-13" class="section level4">
<h4><span class="header-section-number">3.3.2.2</span> 导入网络数据集</h4>
<p>网络数据集是存放在 Stata 公司服务器上的一些数据集，通常也是一些示例数据集。例如导入 <code>lifeexp.dta</code> 数据集：</p>
<pre class="stata"><code>webuse lifeexp, clear
*&gt; (Life expectancy, 1998)</code></pre>
<p>这是一个1998年预期寿命数据集，括号里面的内容是数据集的标签(<code>help label</code>)。</p>
<p><code>webuse query</code>可以用来查看当前webuse指向的数据仓库地址：</p>
<pre class="stata"><code>webuse query
*&gt; (prefix now &quot;http://www.stata-press.com/data/r15&quot;)</code></pre>
<p>我还可以换个地址：</p>
<pre class="stata"><code>webuse set &quot;https://czxa.github.io/cuse/c&quot;
*&gt; (prefix now &quot;https://czxa.github.io/cuse/c&quot;)</code></pre>
<p>这个网址是我的数据仓库下的一个名称为c的子文件夹，里面放置着c开头的数据集。设定好网址指向之后就可以调用该指向下的数据集了：</p>
<pre class="stata"><code>webuse cjd1617, clear
*&gt; (金融学16和17年成绩单)</code></pre>
<p>这是我们班同学2016和2017年的成绩单，为了保护隐私，我抹去了大家的姓名。
重新把webuse的指向的网址指向设定为默认网址，只需要运行下面的命令即可：</p>
<pre class="stata"><code>webuse set
*&gt; (prefix now &quot;http://www.stata-press.com/data/r15&quot;)</code></pre>
</div>
<div id="section-14" class="section level4">
<h4><span class="header-section-number">3.3.2.3</span> 调用我的个人仓库里面的数据集</h4>
<p>在实际数据处理过程中，有时候我们会需要一些常用的数据集，例如中国行政区划编码。如果每次我们都上网找然后再导入 Stata 进行整理，是不是太麻烦了？我们能不能像 sysuse、webuse 这样直接使用数据呢？所以我就写了这套 <code>cuse</code> 命令。这个命令里面包含了很多我经常使用的数据集，例如各省市的行政区号之类的。</p>
<p>运行下面的命令即可安装这个命令：</p>
<pre class="stata"><code>github install czxa/cuse, replace</code></pre>
<p>这个命令的使用方法是：</p>
<pre class="stata"><code>* cuselist可以用来查看数据库中包含的数据
cuselist
*&gt; 【0】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  000001.dta: 平安银行历史股票数据
*&gt; 【a】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  amricancellmapdata.dta: 美国蜂窝地图各个省份的位置坐标
*&gt; 【c】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  cellmapdata.dta: 中国蜂窝地图各个省份的位置坐标
*&gt; 1.  countycode.dta: 中国各省市区县编号(即身份证前六位号码)
*&gt; 2.  china_label.dta: 中国地图标签
*&gt; 3.  china_map.dta: 中国地图数据
*&gt; 4.  china_city_spatial_distance.dta: 中国地级地图数据集
*&gt; 5.  china_province_spatial_distance.dta: 中国省级地图数据集
*&gt; 6.  cjd1617.dta: 金融学16和17年成绩单
*&gt; 7.  cpi.dta: 中国CPI2008/1-2017/11
*&gt; 8.  countrysexratio.dta: knoema各国总人口性别比例数据
*&gt; 9.  ctbc2.dta: 中债国债2002-2017年国债到期收益率
*&gt; 10.  cnstockholiday.dta: 上交所与深交所休市日期
*&gt; 11.  cnstockincome.dta:1989年-2017年所有上市公司的基本收入状况
*&gt; ----------------------------------------------------------------------
*&gt; 【d】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  echarts_worldmap.dta: ECharts世界地图各国中英文名称对照
*&gt; 【g】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  gdpjdlj.dta: 中国GDP季度累计2006/第一季度-2017/第三季度
*&gt; 2.  gini_prov.dta: 1995-2010中国各省份Gini系数
*&gt; 【h】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  huaihe.dta: 2017年淮河供暖政策对人预期寿命的影响模仿数据集
*&gt; 2.  houseprice.dta: 中国百城房价数据集
*&gt; ----------------------------------------------------------------------
*&gt; 【j】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  jdcourse2018a.dta: 2018年上半年暨南大学排课选课表
*&gt; 2.  jd2017zsjh.dta: 暨南大学2017年各省招生人数
*&gt; ----------------------------------------------------------------------
*&gt; 【l】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  life_expentancy.dta: 2010年中国各省市自治区人口出生时预期寿命
*&gt; 【m】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  moneysupply.dta: 2008/1-2017/11中国货币供应量M0M1M2
*&gt; ----------------------------------------------------------------------
*&gt; 【p】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  pm10.dta: 2017年淮河供暖政策对人预期寿命影响的原始数据集
*&gt; 2.  population.dta: 2010年中国各区县人口
*&gt; 3.  population_prov.dta: 2002-2014年全国各省市年末人口
*&gt; 4.  pjw.dta: 分城市人口、就业与工资(1990-2016)
*&gt; ----------------------------------------------------------------------
*&gt; 【s】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  station.dta: 中国所有火车站车站代码
*&gt; 2.  smoking.dta: 合成控制法的美国39个洲的香烟销售量数据集
*&gt; 2.  sexratio.dta: knoema各国总人口性别比例数据
*&gt; ----------------------------------------------------------------------
*&gt; 【t】
*&gt; ----------------------------------------------------------------------
*&gt; 1.  titanic.dta: 泰坦尼克号生存数据集
*&gt; 2.  tourism.dta: 旅游事业发展情况
*&gt; ----------------------------------------------------------------------
*&gt; 【书籍数据集】
*&gt; 注意！如果你想调用的数据集的名字里含大写字母，你需要把它的首字母调成小写才能调用!
*&gt; 1. 《计量经济学及Stata应用》——陈强著
*&gt; 2. 《高级计量经济学及Stata应用》——陈强著
*&gt; 3. 《An Introduction to Stata Programming, Second Edition》——Christopher F. Baum著</code></pre>
<p>然后如果你想调用需要的数据集，使用 cuse 命令，这个命令的语法是：</p>
<blockquote>
<p>cuse filename , [<u>c</u>lear <u>w</u>eb <u>s</u>avetosystem]</p>
</blockquote>
<p>下划线表明该选项可以简写为下划线部分。</p>
<ul>
<li><u>c</u>lear：清空当前数据集；</li>
<li><u>w</u>eb：表示从网络读取数据，对我的电脑来说，这是个可选项，对于别人的电脑来说，这是个必选项。</li>
<li><u>s</u>avetosystem表示调用的同时把该数据集存入系统文件夹。</li>
</ul>
<p>例如，假如我想调用 <code>grilic_small.dta</code> 数据集，使用下面的命令即可：</p>
<pre class="stata"><code>cuse grilic_small, c w s</code></pre>
<p>上面的命令就实现了把内存清空、从网络获取数据和存入系统文件夹三个操作，以后如果需要这个数据集，用sysuse也可以读取了：</p>
<pre class="stata"><code>sysuse grilic_small, clear</code></pre>
</div>
</div>
<div id="dta" class="section level3">
<h3><span class="header-section-number">3.3.3</span> 读入dta数据集</h3>
<p>这个是最为常用的命令， use 命令。用来导入 Stata 的 dta 格式的数据集。</p>
<p>例如我想读取<code>grilic_small.dta</code>数据集，下面的命令即可：</p>
<pre class="stata"><code>* 首先把工作目录设置到这个数据集所在的文件夹
cd ~/Desktop/datasets
* 然后使用use命令读取该数据集
use grilic_small, clear
* 当然你也可以这么做，也就是路径+文件名
use ~/Desktop/datasets/grilic_small.dta, clear
* 但是不推荐。建议的工作流程是把所有的工作都在工作目录下进行。</code></pre>
</div>
<div id="csv" class="section level3">
<h3><span class="header-section-number">3.3.4</span> 读入csv数据集</h3>
<p>csv格式的数据集是逗号分隔的文本文件，可以直接用Excel打开。例如，我想读取 <code>pingan.csv</code> 文件，这个文件下载地址为：<code>https://czxb.github.io/mr/pingan.csv</code> 。</p>
<p>Stata的copy命令可以被用来下载文件：</p>
<pre class="stata"><code>copy &quot;https://czxb.github.io/mr/pingan.csv&quot; pingan.csv, replace</code></pre>
<p>然后你就能在你的工作目录里面发现这个文件了。如果你不清楚你的工作目录在哪里，可以运行下面的命令：</p>
<pre class="stata"><code>pwd
*&gt; /Users/czx/Desktop</code></pre>
<p>然后我们把这个csv文件读入Stata：</p>
<pre class="stata"><code>import delimited using pingan.csv, clear</code></pre>
<p>此外，你还可以通过 GUI (图形用户界面) 导入：</p>
<div class="figure" style="text-align: center"><span id="fig:csvgui1"></span>
<img src="assets/csvgui1.png" alt="Stata 通过 GUI 导入 csv 数据(1)" width="90%" />
<p class="caption">
图 3.5: Stata 通过 GUI 导入 csv 数据(1)
</p>
</div>
<p>稍等片刻，在对话框里进行选择，然后提交即可：</p>
<div class="figure" style="text-align: center"><span id="fig:csvgui2"></span>
<img src="assets/csvgui2.png" alt="Stata 通过 GUI 导入 csv 数据(2)" width="70%" />
<p class="caption">
图 3.6: Stata 通过 GUI 导入 csv 数据(2)
</p>
</div>
<p>为了保存这个操作，我们最好把这个提交动作的命令复制粘贴到我们的do文档里面：</p>
<pre class="stata"><code>import delimited /Users/czx/Desktop/pingan.csv, ///
    delimiter(comma) varnames(1) encoding(utf8) clear</code></pre>
</div>
<div id="xlsxlsx" class="section level3">
<h3><span class="header-section-number">3.3.5</span> 读入xls、xlsx数据</h3>
<p>这两种格式的数据是 Excel 的数据，例如我想导入 <code>grilic_small.xls</code> 数据集：</p>
<pre class="stata"><code>* 首先用copy下载：
copy &quot;https://czxb.github.io/mr/grilic_small.xls&quot; grilic_small.xls, replace
import excel using grilic_small.xls, clear firstrow</code></pre>
<p><code>firstrow</code> 表示设定第一行为变量名。</p>
<p>同样导入 Excel 文件也能通过界面鼠标点击操作。</p>
</div>
<div id="txt" class="section level3">
<h3><span class="header-section-number">3.3.6</span> 导入自由格式的txt文件</h3>
<p>下面我要介绍的这种是在使用Stata爬数据的时候最为常用的一种方法了。</p>
<p>假如我想爬东方财富网的采购经理人指数：网址是：<a href="http://data.eastmoney.com/cjsj/pmi.html">中国 采购经理人指数（PMI）</a>。那么第一步就是我的把这个网页读入Stata，下面的命令就可以实现了：</p>
<pre class="stata"><code>* 首先把这个网页下载存储为temp.txt文件：
copy &quot;http://data.eastmoney.com/cjsj/pmi.html&quot; temp.txt, replace
* 然后读入Stata，把每一行的前20000个字符（可以确定是整行了）读入strL格式的变量v。
infix strL v 1-20000 using temp.txt, clear</code></pre>
<p>然后你会发现这个变量v里面的有些观测值是乱码的，这是因为这个网页文件不是 <code>UTF-8</code> 编码的，所以需要先把这个 <code>temp.txt</code> 文件转一下码。 Stata 中的转码命令是：</p>
<pre class="stata"><code>unicode encoding set gb18030
unicode translate 文件名.后缀名
unicode erasebackups, badidea</code></pre>
<p>所以我们把这个temp.txt文件转个码再读如Stata中：</p>
<pre class="stata"><code>* 首先清空内存，这个清空是非常彻底的清空。
clear all
copy &quot;http://data.eastmoney.com/cjsj/pmi.html&quot; temp.txt, replace
unicode encoding set gb18030
unicode translate temp.txt
unicode erasebackups, badidea
infix strL v 1-20000 using temp.txt, clear</code></pre>
<p>然后就会发现乱码问题得到了解决。
Stata14之前的版本创建的数据集读入Stata14、15都是需要转码的，都可以用这三句命令完成。</p>
<p>但是每次都打这三句是不是非常麻烦？所以我简单把这三句封装成了一个小命令<code>utrans</code>。
这个命令位于我的finance命令包中，安装finance包即可安装这个命令：</p>
<pre class="stata"><code>github install czxa/finance, replace</code></pre>
<p>然后上面的转码只需要<code>utrans + 文件即可完成</code>：</p>
<pre class="stata"><code>utrans temp.txt
*&gt; 转码完成</code></pre>
</div>
</div>
<div id="section-15" class="section level2">
<h2><span class="header-section-number">3.4</span> 数据处理</h2>
<p>当我们把数据读入之后就能进行数据处理了。数据处理的熟练程度直接决定了你写论文的速度。这里介绍一些常用的Stata处理数据的命令。</p>
<div id="describe" class="section level3">
<h3><span class="header-section-number">3.4.1</span> describe：审视数据</h3>
<p>这个命令可以被简写为<code>des</code>。建议初学者不要立即使用简写，以免后来记不住命令的全称。</p>
<pre class="stata"><code>sysuse auto, clear
*&gt; (1978 Automobile Data)

des
*&gt; Contains data from /Applications/Stata/ado/base/a/auto.dta
*&gt;   obs:            74                          1978 Automobile Data
*&gt;  vars:            12                          13 Apr 2016 17:45
*&gt;  size:         3,182                          (_dta has notes)
*&gt; ----------------------------------------------------------------------
*&gt;               storage   display    value
*&gt; variable name   type    format     label      variable label
*&gt; ----------------------------------------------------------------------
*&gt; make            str18   %-18s                 Make and Model
*&gt; price           int     %8.0gc                Price
*&gt; mpg             int     %8.0g                 Mileage (mpg)
*&gt; rep78           int     %8.0g                 Repair Record 1978
*&gt; headroom        float   %6.1f                 Headroom (in.)
*&gt; trunk           int     %8.0g                 Trunk space (cu. ft.)
*&gt; weight          int     %8.0gc                Weight (lbs.)
*&gt; length          int     %8.0g                 Length (in.)
*&gt; turn            int     %8.0g                 Turn Circle (ft.)
*&gt; displacement    int     %8.0g                 Displacement (cu. in.)
*&gt; gear_ratio      float   %6.2f                 Gear Ratio
*&gt; foreign         byte    %8.0g      origin     Car type
*&gt; ----------------------------------------------------------------------
*&gt; Sorted by: foreign</code></pre>
</div>
<div id="list" class="section level3">
<h3><span class="header-section-number">3.4.2</span> list：列示数据</h3>
<p>这个命令有两种用法，第一种是列示某些变量，第二种是列示某些观测值：</p>
<pre class="stata"><code>/* 列示整个数据表 */
list

/* 列示变量price和make */
list price make

/* 列示所有变量的第5-10个观测值 */
list in 5/10

/* 列示变量price和make的最后一个观测值 */
list price make in -1

/* 列示price大于10000的部分 */
list price if price &gt; 10000</code></pre>
</div>
<div id="gsortorder" class="section level3">
<h3><span class="header-section-number">3.4.3</span> gsort/order：排序</h3>
<p>sort命令正在被逐渐弃用。gsort用于观测值的排序，order用于变量的排序。</p>
<pre class="stata"><code>/* 把price按照由低到高的顺序排列 */
gsort price

/* 把price按照由高到低的顺序排列 */
gsort -price

/* 先排rep78再排price */
gsort rep78 -price</code></pre>
</div>
<div id="codebook" class="section level3">
<h3><span class="header-section-number">3.4.4</span> codebook：描述变量的基本信息</h3>
<pre class="stata"><code>codebook
codebook price
*&gt; --------------------------------------------------------------------------
*&gt; price                                                               Price
*&gt; --------------------------------------------------------------------------
*&gt; 
*&gt;                   type:  numeric (int)
*&gt; 
*&gt;                  range:  [3291,15906]                 units:  1
*&gt;          unique values:  74                       missing .:  0/74
*&gt; 
*&gt;                   mean:   6165.26
*&gt;               std. dev:    2949.5
*&gt; 
*&gt;            percentiles:        10%       25%       50%       75%       90%
*&gt;                               3895      4195    5006.5      6342     11385</code></pre>
<p>从上面的结果中可以看到：
1. price 变量为数值型变量；
2. 范围在 [3291,15906]；
3. 有74个观测值，互不相同且没有缺失值；
4. 均值为6165.26，标准差为2949.5；
5. 分位数看起来是合理的。</p>
</div>
<div id="generate" class="section level3">
<h3><span class="header-section-number">3.4.5</span> generate：生成新变量</h3>
<p>这个命令可以简写为<code>gen</code>。</p>
<pre class="stata"><code>/* 例如我想生成一列等于观测值编号的变量v */
gen v = _n

/* 再例如我想生成一列等于总观测值数据的变量v1 */
gen v1 = _N

/* 还可以和数学函数一起使用，例如生成pirce的平方序列 */
gen price2 = price^2</code></pre>
<p>gen还可以和by/bysort一起使用。例如我想生成一个表示rep78变量的每个值的个数的变量v2：</p>
<pre class="stata"><code>bysort rep78: gen v2 = _N
* 或者
bysort rep78: egen v3 = count(mpg)</code></pre>
</div>
<div id="replace-" class="section level3">
<h3><span class="header-section-number">3.4.6</span> replace: 替换</h3>
<pre class="stata"><code>/* 例如把rep78中的缺失值都替换成0(Stata中的数值型变量的缺失值用点表示，其实际数值是无穷大) */
replace rep78 = 0 if rep78 == .

/* 或者 */
replace rep78 = 0 if missing(rep78)

/* 把 price 变量取值在 10000-15000 的观测值替换成-1 */
replace price = -1 if inrange(price, 10000, 15000)

/* 把 make 变量取值为 &quot;Olds Starfire&quot; 和 &quot;Dodge St. Regis&quot; 的替换成 &quot;&quot; (空字符串) */
replace make = &quot;&quot; if inlist(make, &quot;Olds Starfire&quot;, &quot;Dodge St. Regis&quot;)

/* 把 make 变量中含字母A的观测值替换成空字符串 */
replace make = &quot;&quot; if index(make, &quot;A&quot;)</code></pre>
</div>
<div id="rename" class="section level3">
<h3><span class="header-section-number">3.4.7</span> rename：重命名变量</h3>
<p>这个命令可以简写为ren。</p>
<pre class="stata"><code>/* 例如把 make 重命名为 make1 */
ren make make1</code></pre>
</div>
<div id="drop" class="section level3">
<h3><span class="header-section-number">3.4.8</span> drop：删除</h3>
<p>这个命令也有两种用法：删除变量和删除观测值。</p>
<pre class="stata"><code>/* 删除变量make1 */
drop make1

/* 删除第5-10个观测值 */
drop in 5/10

/* 删除price大于10000的观测值 */
drop if price &gt; 10000

/* 使用通配符：删除m开头的变量 */
drop m*</code></pre>
</div>
<div id="summarize" class="section level3">
<h3><span class="header-section-number">3.4.9</span> summarize：查看描述性统计量</h3>
<p>这个命令可以简写为 sum ：</p>
<pre class="stata"><code>sum price
sum price if price &gt; 10000
sum price, detail</code></pre>
</div>
<div id="tabulate" class="section level3">
<h3><span class="header-section-number">3.4.10</span> tabulate：查看频率频数表</h3>
<p>这个命令可以被简写为 tab：</p>
<pre class="stata"><code>tab rep78</code></pre>
</div>
<div id="pwcorr" class="section level3">
<h3><span class="header-section-number">3.4.11</span> pwcorr：计算相关系数表</h3>
<pre class="stata"><code>pwcorr price length weight, star(0.05) sig</code></pre>
<ul>
<li>star 表示在5%显著性水平上显著的相关系数上标星星。</li>
<li>sig 表示显示显著性水平。</li>
</ul>
<p>corr 命令也能用于计算相关系数表：</p>
<pre class="stata"><code>corr price weight

/* 还可以用来计算协方差矩阵 */
corr price weight, c</code></pre>
</div>
<div id="display" class="section level3">
<h3><span class="header-section-number">3.4.12</span> display</h3>
<p>这个命令可以被简写为<code>di</code>，用于打印：</p>
<pre class="stata"><code>display &quot;这是一行字符串&quot;
di as text &quot;这是一行字符串&quot;
di as error &quot;这是一行字符串&quot;
di as result &quot;这是一行字符串&quot;
di in green &quot;这是一行字符串&quot;
di in red &quot;这是一行字符串&quot;
di in yellow &quot;这是一行字符串&quot;
di in white &quot;这是一行字符串&quot;
di as input di in white &quot;这是一行字符串&quot;
di 3 + 4
di 2^0.5

sysuse auto, clear
*&gt; (1978 Automobile Data)

summarize mpg
*&gt; 
*&gt;     Variable |        Obs        Mean    Std. Dev.       Min        Max
*&gt; -------------+---------------------------------------------------------
*&gt;          mpg |         74     21.2973    5.785503         12         41
*&gt; 

di as text &quot;mean of mpg = &quot; as result r(mean)
*&gt; mean of mpg = 21.297297</code></pre>
</div>
</div>
<div id="section-16" class="section level2">
<h2><span class="header-section-number">3.5</span> 数据导出</h2>
<div id="save-dta" class="section level3">
<h3><span class="header-section-number">3.5.1</span> save: 导出为dta文件</h3>
<pre class="stata"><code>save auto2, replace</code></pre>
</div>
<div id="export-delimitedcsv" class="section level3">
<h3><span class="header-section-number">3.5.2</span> export delimited：导出为csv文件</h3>
<pre class="stata"><code>export delimited using auto2.csv, replace</code></pre>
</div>
<div id="export-excelexcel" class="section level3">
<h3><span class="header-section-number">3.5.3</span> export excel：导出为excel文件</h3>
<pre class="stata"><code>export excel using auto2.xlsx, replace</code></pre>
</div>
</div>
<div id="section-17" class="section level2">
<h2><span class="header-section-number">3.6</span> 绘图</h2>
<div id="histogram" class="section level3">
<h3><span class="header-section-number">3.6.1</span> histogram：绘制直方图</h3>
<p>这个命令可以被简写为hist：</p>
<pre class="stata"><code>cuse grilic_small, c w
hist s, width(1) freq</code></pre>
<ul>
<li>width：组宽</li>
<li>freq：设定纵轴为频数，默认是密度</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:hist"></span>
<img src="assets/hist.png" alt="直方图" width="60%" />
<p class="caption">
图 3.7: 直方图
</p>
</div>
<blockquote>
<p>推荐大家使用plotplain主题，刚刚安装 finance 命令包的时候这个主题已经安装好了，使用 scheme() 选项可以指定选项。</p>
</blockquote>
<pre class="stata"><code>hist s, width(1) freq sch(plotplain)</code></pre>
</div>
<div id="scatter" class="section level3">
<h3><span class="header-section-number">3.6.2</span> scatter：绘制散点图</h3>
<pre class="stata"><code>/* 例如，我想观察工资和受教育年限之间的关系 */
gen n = _n
sc lnw s, mlab(n) msize(*2) mc(red*0.6) xti(&quot;受教育年限&quot;) yti(&quot;对数工资&quot;)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter"></span>
<img src="assets/scatter.png" alt="散点图" width="60%" />
<p class="caption">
图 3.8: 散点图
</p>
</div>
</div>
</div>
<div id="section-18" class="section level2">
<h2><span class="header-section-number">3.7</span> 统计相关</h2>
<div id="grilic" class="section level3">
<h3><span class="header-section-number">3.7.1</span> grilic数据集示例</h3>
<pre class="stata"><code>cuse grilic, c w
ren lw lnw
des
sum
sum lnw, d
hist lnw, width(0.1)
kdensity lnw, normal normop(lp(dash)) leg(pos(6) row(1)) ///
  xti(&quot;工资对数&quot;) yti(&quot;密度&quot;) ///
  yla(,format(%6.1f))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:kden"></span>
<img src="assets/kden.png" alt="工资对数的核密度估计图" width="60%" />
<p class="caption">
图 3.9: 工资对数的核密度估计图
</p>
</div>
<pre class="stata"><code>tw ///
kdensity lnw || ///
kdensity lnw if s == 16, lp(dash) ||, ///
    xti(&quot;工资对数&quot;) yti(&quot;密度&quot;) ///
    leg(pos(6) row(1)) ///
    yla(#4, format(%6.1f)) xla(, format(%6.1f)) ///</code></pre>
<div class="figure" style="text-align: center"><span id="fig:kden2"></span>
<img src="assets/kdensity2.png" alt="工资对数的核密度估计图与受教育年限为16年的样本工资对数和密度估计图" width="60%" />
<p class="caption">
图 3.10: 工资对数的核密度估计图与受教育年限为16年的样本工资对数和密度估计图
</p>
</div>
</div>
<div id="section-19" class="section level3">
<h3><span class="header-section-number">3.7.2</span> 验证迭代期望定律</h3>
<p>迭代期望定律：
<span class="math display">\[E(Y) = E_x[E(Y|x)]\]</span></p>
<p>使用数据集grilic.dta来验证该定律：</p>
<p><span class="math display">\[E(lnw) = E_{rns} \times [E(lnw|rns)]\]</span></p>
<ul>
<li>rns是一个虚拟变量，首先我们计算 <code>[E(lnw|rns=1)]</code> 和 <code>[E(lnw|rns=0)]</code></li>
<li>那么 <code>E_rns[E(lnw|rns)]</code> 等于两者的加权平均：</li>
<li>先别急着算，均值这么长，抄起来多累，我们重新开始，这一次使用宏变量来记录每一次的均值。</li>
</ul>
<pre class="stata"><code>cuse grilic, c w
ren lw lnw
sum lnw if rns == 1
return list
local a = r(mean)
sum lnw if rns == 0
return list
local b = r(mean)
di (`a&#39;*204+`b&#39;*554)/(204+554)
*&gt; 5.6867388</code></pre>
<p>另一方面，E(lnw)为：</p>
<pre class="stata"><code>sum lnw</code></pre>
<p>忽略舍入误差，两者完全相等。从而得证。</p>
</div>
</div>
<div id="t" class="section level2">
<h2><span class="header-section-number">3.8</span> t检验、方差分析和因子分析</h2>
<div id="t-1" class="section level3">
<h3><span class="header-section-number">3.8.1</span> t检验</h3>
<p>t检验使用ttest命令。</p>
<div id="t-2" class="section level4">
<h4><span class="header-section-number">3.8.1.1</span> 单样本t检验</h4>
<p>单样本t检验就是均值检验，检验某组数的均值是否等于某个值。
例如检验auto数据集中的mpg的变量是否为20：</p>
<pre class="stata"><code>sysuse auto, clear
ttest mpg == 20  

*&gt; One-sample t test
*&gt; ------------------------------------------------------------------------------
*&gt; Variable |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
*&gt; ---------+--------------------------------------------------------------------
*&gt;      mpg |      74     21.2973    .6725511    5.785503     19.9569    22.63769
*&gt; ------------------------------------------------------------------------------
*&gt;     mean = mean(mpg)                                              t =   1.9289
*&gt; Ho: mean = 20                                    degrees of freedom =       73
*&gt; 
*&gt;     Ha: mean &lt; 20               Ha: mean != 20                 Ha: mean &gt; 20
*&gt;  Pr(T &lt; t) = 0.9712         Pr(|T| &gt; |t|) = 0.0576          Pr(T &gt; t) = 0.0288</code></pre>
</div>
<div id="t-3" class="section level4">
<h4><span class="header-section-number">3.8.1.2</span> 双样本t检验</h4>
<p>双样本t检验也就是检验两组样本的均值是否相等。例如，我想检验国产车和进口车的价格的均值是否相等：</p>
<pre class="stata"><code>ttest price, by(for)

*&gt; Two-sample t test with equal variances
*&gt; ------------------------------------------------------------------------------
*&gt;    Group |     Obs        Mean    Std. Err.   Std. Dev.   [95% Conf. Interval]
*&gt; ---------+--------------------------------------------------------------------
*&gt; Domestic |      52    6072.423    429.4911    3097.104    5210.184    6934.662
*&gt;  Foreign |      22    6384.682    558.9942    2621.915     5222.19    7547.174
*&gt; ---------+--------------------------------------------------------------------
*&gt; combined |      74    6165.257    342.8719    2949.496    5481.914      6848.6
*&gt; ---------+--------------------------------------------------------------------
*&gt;     diff |           -312.2587    754.4488               -1816.225    1191.708
*&gt; ------------------------------------------------------------------------------
*&gt;     diff = mean(Domestic) - mean(Foreign)                         t =  -0.4139
*&gt; Ho: diff = 0                                     degrees of freedom =       72
*&gt; 
*&gt;     Ha: diff &lt; 0                 Ha: diff != 0                 Ha: diff &gt; 0
*&gt;  Pr(T &lt; t) = 0.3401         Pr(|T| &gt; |t|) = 0.6802          Pr(T &gt; t) = 0.6599</code></pre>
</div>
</div>
<div id="section-20" class="section level3">
<h3><span class="header-section-number">3.8.2</span> 方差分析</h3>
<p>方差分析(Analysis of Variance，简称ANOVA)，又称“变异数分析”，是 R.A.Fisher 发明的，用于两个及两个以上样本均数差别的显著性检验。</p>
<div id="section-21" class="section level4">
<h4><span class="header-section-number">3.8.2.1</span> 单因素方差分析</h4>
<pre class="stata"><code>webuse systolic, clear
anova systolic drug

               Number of obs =         58    R-squared     =  0.3355
               Root MSE      =    10.7211    Adj R-squared =  0.2985       
        Source | Partial SS         df         MS        F    Prob&gt;F
    -----------+----------------------------------------------------
         Model |  3133.2385          3   1044.4128      9.09  0.0001
               |
          drug |  3133.2385          3   1044.4128      9.09  0.0001
               |
      Residual |  6206.9167         54    114.9429  
    -----------+----------------------------------------------------
         Total |  9340.1552         57   163.86237  </code></pre>
</div>
<div id="section-22" class="section level4">
<h4><span class="header-section-number">3.8.2.2</span> 双因素方差分析</h4>
<pre class="stata"><code>anova systolic drug disease

*&gt;            Number of obs =         58    R-squared     =  0.3803
*&gt;            Root MSE      =    10.5503    Adj R-squared =  0.3207
*&gt;     Source | Partial SS         df         MS        F    Prob&gt;F
*&gt; -----------+----------------------------------------------------
*&gt;      Model |  3552.0722          5   710.41445      6.38  0.0001
*&gt;            |
*&gt;       drug |  3063.4329          3   1021.1443      9.17  0.0001
*&gt;    disease |  418.83374          2   209.41687      1.88  0.1626
*&gt;            |
*&gt;   Residual |  5788.0829         52   111.30929  
*&gt; -----------+----------------------------------------------------
*&gt;      Total |  9340.1552         57   163.86237  </code></pre>

</div>
</div>
</div>
</div>
<div id="valine-thread"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: true,
        verify: false,
        app_id: 'HS0fE2GH92TyPjSpxeuEpr9P-gzGzoHsz',
        app_key: 'hyvGUifU6e34ODKmahBUtoN6',
        placeholder: '在这里评论～记得留下邮箱哈，这样有回复的时候会有邮件通知。',
        avatar: 'monsterid',
        avatar_cdn: 'https://gravatar.loli.net/avatar/',
        pageSize: '2'
    });
</script>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-8.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-23.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/czxa/stata4ds/edit/master/02-basics.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"download": ["Stata_for_Data_Science.pdf", "Stata_for_Data_Science.epub"],
"toc": {
"collapse": "none"
},
"output_dir": "docs"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
